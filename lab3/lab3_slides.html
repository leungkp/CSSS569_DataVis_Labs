<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>CS&amp;SS 569 Visualizing Data and Models</title>
    <meta charset="utf-8" />
    <meta name="author" content="Brian Leung" />
    <meta name="date" content="2023-01-21" />
    <script src="libs/header-attrs-2.14/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# CS&amp;SS 569 Visualizing Data and Models
]
.subtitle[
## Lab 3: ggplot2
]
.author[
### Brian Leung
]
.institute[
### Department of Political Science, UW
]
.date[
### 2023-01-21
]

---




## Introduction 

- Unpack the design philosophy and inner working of ggplot2

--

- Gain finer control over *each and every* aspect of the graphic design, rather than relying on default 

--

- Showcase some tricks and useful functions common in my own viz workflow

--

- Hopefully it benefits beginners, and intermediate (at least marginally), users to ggplot2

---

## ggplot2 design philosophy 

- Grammar of graphics 

--

  - A statistical graphic is a `mapping` of `data` variables to `aes`thetic attributes of `geom`etric objects. (Wilkinson 2005)

--

- *What* data do you want to visualize?
  
--

  - `ggplot(data = ...)`
  
--
  
- *How* are variables mapped to specific aesthetic attributes?

--

  - `aes(... = ...)`
  
--

  - positions (`x`, `y`), `shape`, `colour`, `size`, `fill`, `alpha`, `linetype`, `label`... 
  
--

  - If the value of an attribute do not vary w.r.t. some variable, don't wrap it within `aes(...)`
  
--

- *Which* geometric shapes do you use to represent the data?

--

  - `geom_{...}`: `geom_point`, `geom_line`, `geom_ribbon`, `geom_polygon`...
  
---

## ggplot2: A layered grammar

- ggplot2: A *layered* grammar of graphics (Wickham 2009)

--
  
  - Build a graphic from multiple layers; each consists of some geometric objects or transformation 
  
--

  - Use `+` to stack up layers

--

- When you declare `ggplot(data = ..., aes(...))`, you're declaring the default specification 

--

- Within each `geom_{}` layer that follows, two things are *inherited* from the default specification at the master level

--

  - Data: inherited from the default data you supply 

--
  
  - Aesthetics: inherited from the default aesthetics (`inherit.aes = TRUE`) 

--
  
  - They are convenient but can create unintended consequences

--

  - We will learn how to overwrite this property for extra flexibility 

---

## Quick demo: inherit.aes = TRUE property


```r
library(tidyverse)

iver_data &lt;- read_csv("https://faculty.washington.edu/cadolph/vis/iverRevised.csv")

head(iver_data)
```

```
# A tibble: 6 × 4
  country   povertyReduction effectiveParties partySystem 
  &lt;chr&gt;                &lt;dbl&gt;            &lt;dbl&gt; &lt;chr&gt;       
1 Australia             42.2             2.38 Majoritarian
2 Belgium               78.8             7.01 Proportional
3 Canada                29.9             1.69 Majoritarian
4 Denmark               71.5             5.04 Proportional
5 Finland               69.1             5.14 Proportional
6 France                57.9             2.68 Majoritarian
```

---

count: false
 
## Why are there multiple smooth curves? -- inherit.aes
.panel1-iver1-non_seq[

```r
ggplot(iver_data,
    aes(x = effectiveParties,
        y = povertyReduction,
        color = partySystem)) +
  geom_point(
  ) +
  geom_smooth(
    method = MASS::rlm
  )
```
]
 
.panel2-iver1-non_seq[
![](lab3_slides_files/figure-html/iver1_non_seq_01_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## Why are there multiple smooth curves? -- inherit.aes
.panel1-iver1-non_seq[

```r
ggplot(iver_data,
    aes(x = effectiveParties,
        y = povertyReduction,
        color = partySystem)) +
  geom_point(
*   inherit.aes = TRUE,
*   aes(x = effectiveParties,
*       y = povertyReduction,
*       color = partySystem)
  ) +
  geom_smooth(
    method = MASS::rlm
  )
```
]
 
.panel2-iver1-non_seq[
![](lab3_slides_files/figure-html/iver1_non_seq_02_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## Why are there multiple smooth curves? -- inherit.aes
.panel1-iver1-non_seq[

```r
ggplot(iver_data,
    aes(x = effectiveParties,
        y = povertyReduction,
        color = partySystem)) +
  geom_point(
    inherit.aes = TRUE,
    aes(x = effectiveParties,
        y = povertyReduction,
        color = partySystem)
  ) +
  geom_smooth(
*   inherit.aes = TRUE,
*   aes(x = effectiveParties,
*       y = povertyReduction,
*       color = partySystem),
    method = MASS::rlm
  )
```
]
 
.panel2-iver1-non_seq[
![](lab3_slides_files/figure-html/iver1_non_seq_03_output-1.png)&lt;!-- --&gt;
]

&lt;style&gt;
.panel1-iver1-non_seq {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-iver1-non_seq {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-iver1-non_seq {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

count: false
 
## You can either overwrite the geom_smooth() layer
.panel1-iver2-non_seq[

```r
ggplot(iver_data,
    aes(x = effectiveParties,
        y = povertyReduction,
        color = partySystem)) +
  geom_point(
  ) +
  geom_smooth(
    method = MASS::rlm
  )
```
]
 
.panel2-iver2-non_seq[
![](lab3_slides_files/figure-html/iver2_non_seq_01_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## You can either overwrite the geom_smooth() layer
.panel1-iver2-non_seq[

```r
ggplot(iver_data,
    aes(x = effectiveParties,
        y = povertyReduction,
        color = partySystem)) +
  geom_point(
  ) +
  geom_smooth(
*   aes(group = 1),
    method = MASS::rlm
  )
```
]
 
.panel2-iver2-non_seq[
![](lab3_slides_files/figure-html/iver2_non_seq_02_output-1.png)&lt;!-- --&gt;
]

&lt;style&gt;
.panel1-iver2-non_seq {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-iver2-non_seq {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-iver2-non_seq {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;






---

count: false
 
## Or localize color aesthetics to the geom_point layer()
.panel1-iver3-non_seq[

```r
ggplot(iver_data,
    aes(x = effectiveParties,
        y = povertyReduction)) +
  geom_point(
  ) +
  geom_smooth(
    method = MASS::rlm
  )
```
]
 
.panel2-iver3-non_seq[
![](lab3_slides_files/figure-html/iver3_non_seq_01_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## Or localize color aesthetics to the geom_point layer()
.panel1-iver3-non_seq[

```r
ggplot(iver_data,
    aes(x = effectiveParties,
        y = povertyReduction)) +
  geom_point(
*   aes(color = partySystem)
  ) +
  geom_smooth(
    method = MASS::rlm
  )
```
]
 
.panel2-iver3-non_seq[
![](lab3_slides_files/figure-html/iver3_non_seq_02_output-1.png)&lt;!-- --&gt;
]

&lt;style&gt;
.panel1-iver3-non_seq {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-iver3-non_seq {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-iver3-non_seq {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

## A segue to a customized ggplot2 theme 

- Chris and I wrote a customized ggplot2 theme to implement a minimalist aesthetics

--

- Can be downloaded here: https://students.washington.edu/kpleung/vis/theme_cavis.R

--

- To use it 


```r
source("https://students.washington.edu/kpleung/vis/theme_cavis.R")
# source(".../theme_cavis.R") if you have download and put it in your directory
```

--

- I'll use this theme throughout my vis; you don't have to (and suggestions are welcomed!)

---

count: false
 
## Showcase customized theme
.panel1-theme_cavis-rotate[

```r
ggplot(iris,
       aes(x = Sepal.Length,
           y = Petal.Length,
           color = Species)) +
  geom_point() +
* theme_grey()
```
]
 
.panel2-theme_cavis-rotate[
![](lab3_slides_files/figure-html/theme_cavis_rotate_01_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## Showcase customized theme
.panel1-theme_cavis-rotate[

```r
ggplot(iris,
       aes(x = Sepal.Length,
           y = Petal.Length,
           color = Species)) +
  geom_point() +
* theme_cavis_hgrid
```
]
 
.panel2-theme_cavis-rotate[
![](lab3_slides_files/figure-html/theme_cavis_rotate_02_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## Showcase customized theme
.panel1-theme_cavis-rotate[

```r
ggplot(iris,
       aes(x = Sepal.Length,
           y = Petal.Length,
           color = Species)) +
  geom_point() +
* theme_cavis_vgrid
```
]
 
.panel2-theme_cavis-rotate[
![](lab3_slides_files/figure-html/theme_cavis_rotate_03_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## Showcase customized theme
.panel1-theme_cavis-rotate[

```r
ggplot(iris,
       aes(x = Sepal.Length,
           y = Petal.Length,
           color = Species)) +
  geom_point() +
* theme_cavis
```
]
 
.panel2-theme_cavis-rotate[
![](lab3_slides_files/figure-html/theme_cavis_rotate_04_output-1.png)&lt;!-- --&gt;
]

&lt;style&gt;
.panel1-theme_cavis-rotate {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-theme_cavis-rotate {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-theme_cavis-rotate {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

## Visualization exercises: Electric vehicles in WA state 

- Data are taken from [Washington State Department of Licensing](https://data.wa.gov/Transportation/Electric-Vehicle-Population-Data/f6w7-q2d2)

--

- "This dataset shows the Battery Electric Vehicles (BEVs) and Plug-in Hybrid Electric Vehicles (PHEVs) that are currently registered through Washington State Department of Licensing (DOL)."

--

- Load the electric vehicles data 


```r
ev_data &lt;- read_csv("data/ev_data.csv")
head(ev_data)
```

```
# A tibble: 6 × 8
  county    city      make   model   model_year ev_type          elect…¹ retai…²
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;   &lt;dbl&gt;
1 Kittitas  Cle Elum  TESLA  MODEL Y       2020 Battery Electri…     291       0
2 Chelan    Chelan    TESLA  MODEL 3       2020 Battery Electri…     322       0
3 Snohomish Snohomish TESLA  MODEL 3       2018 Battery Electri…     215       0
4 Thurston  Tumwater  FORD   C-MAX         2014 Plug-in Hybrid …      19       0
5 Kitsap    Kingston  FORD   FUSION        2013 Plug-in Hybrid …      19       0
6 King      Seattle   NISSAN LEAF          2018 Battery Electri…     151       0
# … with abbreviated variable names ¹​electric_range, ²​retail_price
```

---

## Visualization exercises: Electric vehicles in WA state 

- Also some auxiliary county data with number of households and their median income 


```r
county_data &lt;- read_csv("data/county_data.csv")
head(county_data)
```

```
# A tibble: 6 × 3
  county      hh_num hh_income
  &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;
1 King        789232     68065
2 San Juan      7613     50726
3 Snohomish   268325     66300
4 Kitsap       97220     59549
5 Washington 2620076     57244
6 Thurston    100650     60930
```

---

count: false
 
## EV in WA state: Which county has most EVs?
.panel1-ev_by_county1-auto[

```r
# Count EVs by county
*ev_data
```
]
 
.panel2-ev_by_county1-auto[

```
# A tibble: 114,312 × 8
   county    city         make   model   model_year ev_type      elect…¹ retai…²
   &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;
 1 Kittitas  Cle Elum     TESLA  MODEL Y       2020 Battery Ele…     291       0
 2 Chelan    Chelan       TESLA  MODEL 3       2020 Battery Ele…     322       0
 3 Snohomish Snohomish    TESLA  MODEL 3       2018 Battery Ele…     215       0
 4 Thurston  Tumwater     FORD   C-MAX         2014 Plug-in Hyb…      19       0
 5 Kitsap    Kingston     FORD   FUSION        2013 Plug-in Hyb…      19       0
 6 King      Seattle      NISSAN LEAF          2018 Battery Ele…     151       0
 7 Skagit    Mount Vernon AUDI   E-TRON        2019 Battery Ele…     204       0
 8 Kitsap    Port Orchard NISSAN LEAF          2019 Battery Ele…     150       0
 9 Snohomish Bothell      TESLA  MODEL 3       2020 Battery Ele…     322       0
10 Yakima    Tieton       NISSAN LEAF          2019 Battery Ele…     150       0
# … with 114,302 more rows, and abbreviated variable names ¹​electric_range,
#   ²​retail_price
```
]

---
count: false
 
## EV in WA state: Which county has most EVs?
.panel1-ev_by_county1-auto[

```r
# Count EVs by county
ev_data %&gt;%
* count(county)
```
]
 
.panel2-ev_by_county1-auto[

```
# A tibble: 39 × 2
   county       n
   &lt;chr&gt;    &lt;int&gt;
 1 Adams       35
 2 Asotin      46
 3 Benton    1394
 4 Chelan     654
 5 Clallam    741
 6 Clark     6827
 7 Columbia    13
 8 Cowlitz    576
 9 Douglas    227
10 Ferry       27
# … with 29 more rows
```
]

---
count: false
 
## EV in WA state: Which county has most EVs?
.panel1-ev_by_county1-auto[

```r
# Count EVs by county
ev_data %&gt;%
  count(county) %&gt;%
* mutate(county = fct_reorder(county, n))
```
]
 
.panel2-ev_by_county1-auto[

```
# A tibble: 39 × 2
   county       n
   &lt;fct&gt;    &lt;int&gt;
 1 Adams       35
 2 Asotin      46
 3 Benton    1394
 4 Chelan     654
 5 Clallam    741
 6 Clark     6827
 7 Columbia    13
 8 Cowlitz    576
 9 Douglas    227
10 Ferry       27
# … with 29 more rows
```
]

---
count: false
 
## EV in WA state: Which county has most EVs?
.panel1-ev_by_county1-auto[

```r
# Count EVs by county
ev_data %&gt;%
  count(county) %&gt;%
  mutate(county = fct_reorder(county, n)) %&gt;%
* arrange(desc(county))
```
]
 
.panel2-ev_by_county1-auto[

```
# A tibble: 39 × 2
   county        n
   &lt;fct&gt;     &lt;int&gt;
 1 King      60059
 2 Snohomish 12720
 3 Pierce     8684
 4 Clark      6827
 5 Thurston   4207
 6 Kitsap     3902
 7 Whatcom    2873
 8 Spokane    2835
 9 Benton     1394
10 Island     1307
# … with 29 more rows
```
]

---
count: false
 
## EV in WA state: Which county has most EVs?
.panel1-ev_by_county1-auto[

```r
# Count EVs by county
ev_data %&gt;%
  count(county) %&gt;%
  mutate(county = fct_reorder(county, n)) %&gt;%
  arrange(desc(county)) -&gt;
* ev_by_county
```
]
 
.panel2-ev_by_county1-auto[

]

---
count: false
 
## EV in WA state: Which county has most EVs?
.panel1-ev_by_county1-auto[

```r
# Count EVs by county
ev_data %&gt;%
  count(county) %&gt;%
  mutate(county = fct_reorder(county, n)) %&gt;%
  arrange(desc(county)) -&gt;
  ev_by_county

# Load scales package for labels and breaks
*library(scales)
```
]
 
.panel2-ev_by_county1-auto[

]

&lt;style&gt;
.panel1-ev_by_county1-auto {
  color: black;
  width: 88.2%;
  hight: 32%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
.panel2-ev_by_county1-auto {
  color: black;
  width: 9.8%;
  hight: 32%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
.panel3-ev_by_county1-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

count: false
 
## EV in WA state: Which county has most EVs?
.panel1-ev_by_county2-non_seq[

```r
ggplot(ev_by_county,
       aes(y = county, x = n)) +
  theme_cavis_vgrid +
  geom_point()
```
]
 
.panel2-ev_by_county2-non_seq[
![](lab3_slides_files/figure-html/ev_by_county2_non_seq_01_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Which county has most EVs?
.panel1-ev_by_county2-non_seq[

```r
ggplot(ev_by_county,
       aes(y = county, x = n)) +
  theme_cavis_vgrid +
  geom_point() +
* geom_col(
* )
```
]
 
.panel2-ev_by_county2-non_seq[
![](lab3_slides_files/figure-html/ev_by_county2_non_seq_02_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Which county has most EVs?
.panel1-ev_by_county2-non_seq[

```r
ggplot(ev_by_county,
       aes(y = county, x = n)) +
  theme_cavis_vgrid +
  geom_point() +
  geom_col(
*   width = 0.05,
*   alpha = 0.5
  )
```
]
 
.panel2-ev_by_county2-non_seq[
![](lab3_slides_files/figure-html/ev_by_county2_non_seq_03_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Which county has most EVs?
.panel1-ev_by_county2-non_seq[

```r
ggplot(ev_by_county,
       aes(y = county, x = n)) +
  theme_cavis_vgrid +
  geom_point() +
  geom_col(
    width = 0.05,
    alpha = 0.5
  ) +
* scale_x_continuous(
*   trans = "log10",
* )
```
]
 
.panel2-ev_by_county2-non_seq[
![](lab3_slides_files/figure-html/ev_by_county2_non_seq_04_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Which county has most EVs?
.panel1-ev_by_county2-non_seq[

```r
ggplot(ev_by_county,
       aes(y = county, x = n)) +
  theme_cavis_vgrid +
  geom_point() +
  geom_col(
    width = 0.05,
    alpha = 0.5
  ) +
  scale_x_continuous(
    trans = "log10",
*   breaks = 10^(0:5),
*   labels = scales::label_comma(),
  )
```
]
 
.panel2-ev_by_county2-non_seq[
![](lab3_slides_files/figure-html/ev_by_county2_non_seq_05_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Which county has most EVs?
.panel1-ev_by_county2-non_seq[

```r
ggplot(ev_by_county,
       aes(y = county, x = n)) +
  theme_cavis_vgrid +
  geom_point() +
  geom_col(
    width = 0.05,
    alpha = 0.5
  ) +
  scale_x_continuous(
    trans = "log10",
    breaks = 10^(0:5),
    labels = scales::label_comma(),
  ) +
* geom_text(
*   aes(label = n),
* )
```
]
 
.panel2-ev_by_county2-non_seq[
![](lab3_slides_files/figure-html/ev_by_county2_non_seq_06_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Which county has most EVs?
.panel1-ev_by_county2-non_seq[

```r
ggplot(ev_by_county,
       aes(y = county, x = n)) +
  theme_cavis_vgrid +
  geom_point() +
  geom_col(
    width = 0.05,
    alpha = 0.5
  ) +
  scale_x_continuous(
    trans = "log10",
    breaks = 10^(0:5),
    labels = scales::label_comma(),
  ) +
  geom_text(
    aes(label = n),
*   nudge_x = 0.15
  )
```
]
 
.panel2-ev_by_county2-non_seq[
![](lab3_slides_files/figure-html/ev_by_county2_non_seq_07_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Which county has most EVs?
.panel1-ev_by_county2-non_seq[

```r
ggplot(ev_by_county,
       aes(y = county, x = n)) +
  theme_cavis_vgrid +
  geom_point() +
  geom_col(
    width = 0.05,
    alpha = 0.5
  ) +
  scale_x_continuous(
    trans = "log10",
    breaks = 10^(0:5),
    labels = scales::label_comma(),
  ) +
  geom_text(
*   data = slice_max(ev_by_county, n, n = 10),
    aes(label = n),
    nudge_x = 0.15
  )
```
]
 
.panel2-ev_by_county2-non_seq[
![](lab3_slides_files/figure-html/ev_by_county2_non_seq_08_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Which county has most EVs?
.panel1-ev_by_county2-non_seq[

```r
ggplot(ev_by_county,
       aes(y = county, x = n)) +
  theme_cavis_vgrid +
  geom_point() +
  geom_col(
    width = 0.05,
    alpha = 0.5
  ) +
  scale_x_continuous(
    trans = "log10",
    breaks = 10^(0:5),
    labels = scales::label_comma(),
  ) +
  geom_text(
    data = slice_max(ev_by_county, n, n = 10),
    aes(label = n),
    nudge_x = 0.15
  ) +
* labs(y = NULL, x = "Total number of EVs")
```
]
 
.panel2-ev_by_county2-non_seq[
![](lab3_slides_files/figure-html/ev_by_county2_non_seq_09_output-1.png)&lt;!-- --&gt;
]

&lt;style&gt;
.panel1-ev_by_county2-non_seq {
  color: black;
  width: 49%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-ev_by_county2-non_seq {
  color: black;
  width: 49%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-ev_by_county2-non_seq {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

count: false
 
## EV in WA state: Trend of number of EVs across county
.panel1-ev_by_countyYear1-auto[

```r
# Count number of EVs by county
*ev_data
```
]
 
.panel2-ev_by_countyYear1-auto[

```
# A tibble: 114,312 × 8
   county    city         make   model   model_year ev_type      elect…¹ retai…²
   &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;
 1 Kittitas  Cle Elum     TESLA  MODEL Y       2020 Battery Ele…     291       0
 2 Chelan    Chelan       TESLA  MODEL 3       2020 Battery Ele…     322       0
 3 Snohomish Snohomish    TESLA  MODEL 3       2018 Battery Ele…     215       0
 4 Thurston  Tumwater     FORD   C-MAX         2014 Plug-in Hyb…      19       0
 5 Kitsap    Kingston     FORD   FUSION        2013 Plug-in Hyb…      19       0
 6 King      Seattle      NISSAN LEAF          2018 Battery Ele…     151       0
 7 Skagit    Mount Vernon AUDI   E-TRON        2019 Battery Ele…     204       0
 8 Kitsap    Port Orchard NISSAN LEAF          2019 Battery Ele…     150       0
 9 Snohomish Bothell      TESLA  MODEL 3       2020 Battery Ele…     322       0
10 Yakima    Tieton       NISSAN LEAF          2019 Battery Ele…     150       0
# … with 114,302 more rows, and abbreviated variable names ¹​electric_range,
#   ²​retail_price
```
]

---
count: false
 
## EV in WA state: Trend of number of EVs across county
.panel1-ev_by_countyYear1-auto[

```r
# Count number of EVs by county
ev_data %&gt;%
* group_by(model_year, county)
```
]
 
.panel2-ev_by_countyYear1-auto[

```
# A tibble: 114,312 × 8
# Groups:   model_year, county [497]
   county    city         make   model   model_year ev_type      elect…¹ retai…²
   &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;
 1 Kittitas  Cle Elum     TESLA  MODEL Y       2020 Battery Ele…     291       0
 2 Chelan    Chelan       TESLA  MODEL 3       2020 Battery Ele…     322       0
 3 Snohomish Snohomish    TESLA  MODEL 3       2018 Battery Ele…     215       0
 4 Thurston  Tumwater     FORD   C-MAX         2014 Plug-in Hyb…      19       0
 5 Kitsap    Kingston     FORD   FUSION        2013 Plug-in Hyb…      19       0
 6 King      Seattle      NISSAN LEAF          2018 Battery Ele…     151       0
 7 Skagit    Mount Vernon AUDI   E-TRON        2019 Battery Ele…     204       0
 8 Kitsap    Port Orchard NISSAN LEAF          2019 Battery Ele…     150       0
 9 Snohomish Bothell      TESLA  MODEL 3       2020 Battery Ele…     322       0
10 Yakima    Tieton       NISSAN LEAF          2019 Battery Ele…     150       0
# … with 114,302 more rows, and abbreviated variable names ¹​electric_range,
#   ²​retail_price
```
]

---
count: false
 
## EV in WA state: Trend of number of EVs across county
.panel1-ev_by_countyYear1-auto[

```r
# Count number of EVs by county
ev_data %&gt;%
  group_by(model_year, county) %&gt;%
* count()
```
]
 
.panel2-ev_by_countyYear1-auto[

```
# A tibble: 497 × 3
# Groups:   model_year, county [497]
   model_year county        n
        &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt;
 1       1997 Snohomish     1
 2       1998 Clallam       1
 3       1999 Pierce        1
 4       1999 Skagit        1
 5       1999 Whatcom       1
 6       2000 King          4
 7       2000 San Juan      2
 8       2000 Snohomish     1
 9       2000 Whatcom       2
10       2002 Clallam       1
# … with 487 more rows
```
]

---
count: false
 
## EV in WA state: Trend of number of EVs across county
.panel1-ev_by_countyYear1-auto[

```r
# Count number of EVs by county
ev_data %&gt;%
  group_by(model_year, county) %&gt;%
  count() -&gt;
* ev_by_countyYear
```
]
 
.panel2-ev_by_countyYear1-auto[

]

&lt;style&gt;
.panel1-ev_by_countyYear1-auto {
  color: black;
  width: 88.2%;
  hight: 32%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
.panel2-ev_by_countyYear1-auto {
  color: black;
  width: 9.8%;
  hight: 32%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
.panel3-ev_by_countyYear1-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

count: false
 
## EV in WA state: Trend of number of EVs across county
.panel1-ev_by_countyYear2-auto[

```r
*ggplot(ev_by_countyYear,
*      aes(x = model_year,
*          y = n,
*          group = county,
*          color = county == "King"))
```
]
 
.panel2-ev_by_countyYear2-auto[
![](lab3_slides_files/figure-html/ev_by_countyYear2_auto_01_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Trend of number of EVs across county
.panel1-ev_by_countyYear2-auto[

```r
ggplot(ev_by_countyYear,
       aes(x = model_year,
           y = n,
           group = county,
           color = county == "King")) +
* theme_cavis_hgrid
```
]
 
.panel2-ev_by_countyYear2-auto[
![](lab3_slides_files/figure-html/ev_by_countyYear2_auto_02_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Trend of number of EVs across county
.panel1-ev_by_countyYear2-auto[

```r
ggplot(ev_by_countyYear,
       aes(x = model_year,
           y = n,
           group = county,
           color = county == "King")) +
  theme_cavis_hgrid +
* geom_line()
```
]
 
.panel2-ev_by_countyYear2-auto[
![](lab3_slides_files/figure-html/ev_by_countyYear2_auto_03_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Trend of number of EVs across county
.panel1-ev_by_countyYear2-auto[

```r
ggplot(ev_by_countyYear,
       aes(x = model_year,
           y = n,
           group = county,
           color = county == "King")) +
  theme_cavis_hgrid +
  geom_line() +
* scale_y_continuous(trans = "log10")
```
]
 
.panel2-ev_by_countyYear2-auto[
![](lab3_slides_files/figure-html/ev_by_countyYear2_auto_04_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Trend of number of EVs across county
.panel1-ev_by_countyYear2-auto[

```r
ggplot(ev_by_countyYear,
       aes(x = model_year,
           y = n,
           group = county,
           color = county == "King")) +
  theme_cavis_hgrid +
  geom_line() +
  scale_y_continuous(trans = "log10") +
* scale_color_manual(values = c("grey90", "red"))
```
]
 
.panel2-ev_by_countyYear2-auto[
![](lab3_slides_files/figure-html/ev_by_countyYear2_auto_05_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Trend of number of EVs across county
.panel1-ev_by_countyYear2-auto[

```r
ggplot(ev_by_countyYear,
       aes(x = model_year,
           y = n,
           group = county,
           color = county == "King")) +
  theme_cavis_hgrid +
  geom_line() +
  scale_y_continuous(trans = "log10") +
  scale_color_manual(values = c("grey90", "red")) +
* guides(color = "none")
```
]
 
.panel2-ev_by_countyYear2-auto[
![](lab3_slides_files/figure-html/ev_by_countyYear2_auto_06_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Trend of number of EVs across county
.panel1-ev_by_countyYear2-auto[

```r
ggplot(ev_by_countyYear,
       aes(x = model_year,
           y = n,
           group = county,
           color = county == "King")) +
  theme_cavis_hgrid +
  geom_line() +
  scale_y_continuous(trans = "log10") +
  scale_color_manual(values = c("grey90", "red")) +
  guides(color = "none") +
* annotate("text", x = 2018, y = 13000,
*          label = "King County",
*          color = "red")
```
]
 
.panel2-ev_by_countyYear2-auto[
![](lab3_slides_files/figure-html/ev_by_countyYear2_auto_07_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Trend of number of EVs across county
.panel1-ev_by_countyYear2-auto[

```r
ggplot(ev_by_countyYear,
       aes(x = model_year,
           y = n,
           group = county,
           color = county == "King")) +
  theme_cavis_hgrid +
  geom_line() +
  scale_y_continuous(trans = "log10") +
  scale_color_manual(values = c("grey90", "red")) +
  guides(color = "none") +
  annotate("text", x = 2018, y = 13000,
           label = "King County",
           color = "red") +
* geom_vline(xintercept = 2012, linetype = 2,
*            color = "grey45")
```
]
 
.panel2-ev_by_countyYear2-auto[
![](lab3_slides_files/figure-html/ev_by_countyYear2_auto_08_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Trend of number of EVs across county
.panel1-ev_by_countyYear2-auto[

```r
ggplot(ev_by_countyYear,
       aes(x = model_year,
           y = n,
           group = county,
           color = county == "King")) +
  theme_cavis_hgrid +
  geom_line() +
  scale_y_continuous(trans = "log10") +
  scale_color_manual(values = c("grey90", "red")) +
  guides(color = "none") +
  annotate("text", x = 2018, y = 13000,
           label = "King County",
           color = "red") +
  geom_vline(xintercept = 2012, linetype = 2,
             color = "grey45") +
* annotate("text", x = 2010, y = 15000,
*          label = "Tesla Model S\nintroduced",
*          color = "black")
```
]
 
.panel2-ev_by_countyYear2-auto[
![](lab3_slides_files/figure-html/ev_by_countyYear2_auto_09_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Trend of number of EVs across county
.panel1-ev_by_countyYear2-auto[

```r
ggplot(ev_by_countyYear,
       aes(x = model_year,
           y = n,
           group = county,
           color = county == "King")) +
  theme_cavis_hgrid +
  geom_line() +
  scale_y_continuous(trans = "log10") +
  scale_color_manual(values = c("grey90", "red")) +
  guides(color = "none") +
  annotate("text", x = 2018, y = 13000,
           label = "King County",
           color = "red") +
  geom_vline(xintercept = 2012, linetype = 2,
             color = "grey45") +
  annotate("text", x = 2010, y = 15000,
           label = "Tesla Model S\nintroduced",
           color = "black") +
* labs(y = "Number of registed EVs", x = NULL)
```
]
 
.panel2-ev_by_countyYear2-auto[
![](lab3_slides_files/figure-html/ev_by_countyYear2_auto_10_output-1.png)&lt;!-- --&gt;
]

&lt;style&gt;
.panel1-ev_by_countyYear2-auto {
  color: black;
  width: 49%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-ev_by_countyYear2-auto {
  color: black;
  width: 49%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-ev_by_countyYear2-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

count: false
 
## EV in WA state: Relationship between price and range
.panel1-price_range1-auto[

```r
*ev_data
```
]
 
.panel2-price_range1-auto[

```
# A tibble: 114,312 × 8
   county    city         make   model   model_year ev_type      elect…¹ retai…²
   &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;
 1 Kittitas  Cle Elum     TESLA  MODEL Y       2020 Battery Ele…     291       0
 2 Chelan    Chelan       TESLA  MODEL 3       2020 Battery Ele…     322       0
 3 Snohomish Snohomish    TESLA  MODEL 3       2018 Battery Ele…     215       0
 4 Thurston  Tumwater     FORD   C-MAX         2014 Plug-in Hyb…      19       0
 5 Kitsap    Kingston     FORD   FUSION        2013 Plug-in Hyb…      19       0
 6 King      Seattle      NISSAN LEAF          2018 Battery Ele…     151       0
 7 Skagit    Mount Vernon AUDI   E-TRON        2019 Battery Ele…     204       0
 8 Kitsap    Port Orchard NISSAN LEAF          2019 Battery Ele…     150       0
 9 Snohomish Bothell      TESLA  MODEL 3       2020 Battery Ele…     322       0
10 Yakima    Tieton       NISSAN LEAF          2019 Battery Ele…     150       0
# … with 114,302 more rows, and abbreviated variable names ¹​electric_range,
#   ²​retail_price
```
]

---
count: false
 
## EV in WA state: Relationship between price and range
.panel1-price_range1-auto[

```r
ev_data %&gt;%
* distinct(make, model, model_year, ev_type, electric_range, retail_price)
```
]
 
.panel2-price_range1-auto[

```
# A tibble: 427 × 6
   make   model   model_year ev_type                             elect…¹ retai…²
   &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;                                 &lt;dbl&gt;   &lt;dbl&gt;
 1 TESLA  MODEL Y       2020 Battery Electric Vehicle (BEV)          291       0
 2 TESLA  MODEL 3       2020 Battery Electric Vehicle (BEV)          322       0
 3 TESLA  MODEL 3       2018 Battery Electric Vehicle (BEV)          215       0
 4 FORD   C-MAX         2014 Plug-in Hybrid Electric Vehicle (P…      19       0
 5 FORD   FUSION        2013 Plug-in Hybrid Electric Vehicle (P…      19       0
 6 NISSAN LEAF          2018 Battery Electric Vehicle (BEV)          151       0
 7 AUDI   E-TRON        2019 Battery Electric Vehicle (BEV)          204       0
 8 NISSAN LEAF          2019 Battery Electric Vehicle (BEV)          150       0
 9 KIA    NIRO          2018 Plug-in Hybrid Electric Vehicle (P…      26       0
10 NISSAN LEAF          2012 Battery Electric Vehicle (BEV)           73       0
# … with 417 more rows, and abbreviated variable names ¹​electric_range,
#   ²​retail_price
```
]

---
count: false
 
## EV in WA state: Relationship between price and range
.panel1-price_range1-auto[

```r
ev_data %&gt;%
  distinct(make, model, model_year, ev_type, electric_range, retail_price) %&gt;%
* filter(retail_price &gt; 0 &amp; electric_range &gt; 0)
```
]
 
.panel2-price_range1-auto[

```
# A tibble: 32 × 6
   make     model      model_year ev_type                        elect…¹ retai…²
   &lt;chr&gt;    &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;                            &lt;dbl&gt;   &lt;dbl&gt;
 1 KIA      SOUL             2016 Battery Electric Vehicle (BEV)      93   31950
 2 KIA      SOUL EV          2018 Battery Electric Vehicle (BEV)     111   33950
 3 TESLA    MODEL S          2013 Battery Electric Vehicle (BEV)     208   69900
 4 TESLA    MODEL S          2014 Battery Electric Vehicle (BEV)     208   69900
 5 CHRYSLER PACIFICA         2019 Plug-in Hybrid Electric Vehic…      32   39995
 6 MINI     COUNTRYMAN       2018 Plug-in Hybrid Electric Vehic…      12   36800
 7 BMW      530E             2018 Plug-in Hybrid Electric Vehic…      14   54950
 8 TESLA    ROADSTER         2010 Battery Electric Vehicle (BEV)     245  110950
 9 KIA      SOUL EV          2017 Battery Electric Vehicle (BEV)      93   32250
10 VOLVO    XC60             2018 Plug-in Hybrid Electric Vehic…      17   52900
# … with 22 more rows, and abbreviated variable names ¹​electric_range,
#   ²​retail_price
```
]

---
count: false
 
## EV in WA state: Relationship between price and range
.panel1-price_range1-auto[

```r
ev_data %&gt;%
  distinct(make, model, model_year, ev_type, electric_range, retail_price) %&gt;%
  filter(retail_price &gt; 0 &amp; electric_range &gt; 0) -&gt;
* ev_models
```
]
 
.panel2-price_range1-auto[

]

---
count: false
 
## EV in WA state: Relationship between price and range
.panel1-price_range1-auto[

```r
ev_data %&gt;%
  distinct(make, model, model_year, ev_type, electric_range, retail_price) %&gt;%
  filter(retail_price &gt; 0 &amp; electric_range &gt; 0) -&gt;
  ev_models

# load packages
*library(ggrepel)
```
]
 
.panel2-price_range1-auto[

]

---
count: false
 
## EV in WA state: Relationship between price and range
.panel1-price_range1-auto[

```r
ev_data %&gt;%
  distinct(make, model, model_year, ev_type, electric_range, retail_price) %&gt;%
  filter(retail_price &gt; 0 &amp; electric_range &gt; 0) -&gt;
  ev_models

# load packages
library(ggrepel)
*library(RColorBrewer)
```
]
 
.panel2-price_range1-auto[

]

&lt;style&gt;
.panel1-price_range1-auto {
  color: black;
  width: 88.2%;
  hight: 32%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
.panel2-price_range1-auto {
  color: black;
  width: 9.8%;
  hight: 32%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
.panel3-price_range1-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

## A segue to choosing colors

- Use `RColorBrewer` package to choose colors

--

- Choose between sequential, diverging or qualitative palettes based on your data

--

- Check out this [website](https://colorbrewer2.org/)

---

count: false
 
## A segue to choosing colors
.panel1-color1-auto[

```r
*RColorBrewer::display.brewer.all()
```
]
 
.panel2-color1-auto[
![](lab3_slides_files/figure-html/color1_auto_01_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## A segue to choosing colors
.panel1-color1-auto[

```r
RColorBrewer::display.brewer.all()
*colors &lt;- brewer.pal(n = 5, name = "Set1")
```
]
 
.panel2-color1-auto[
![](lab3_slides_files/figure-html/color1_auto_02_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## A segue to choosing colors
.panel1-color1-auto[

```r
RColorBrewer::display.brewer.all()
colors &lt;- brewer.pal(n = 5, name = "Set1")
*print(colors)
```
]
 
.panel2-color1-auto[
![](lab3_slides_files/figure-html/color1_auto_03_output-1.png)&lt;!-- --&gt;

```
[1] "#E41A1C" "#377EB8" "#4DAF4A" "#984EA3" "#FF7F00"
```
]

---
count: false
 
## A segue to choosing colors
.panel1-color1-auto[

```r
RColorBrewer::display.brewer.all()
colors &lt;- brewer.pal(n = 5, name = "Set1")
print(colors)
*blue &lt;- colors[2]
```
]
 
.panel2-color1-auto[
![](lab3_slides_files/figure-html/color1_auto_04_output-1.png)&lt;!-- --&gt;

```
[1] "#E41A1C" "#377EB8" "#4DAF4A" "#984EA3" "#FF7F00"
```
]

---
count: false
 
## A segue to choosing colors
.panel1-color1-auto[

```r
RColorBrewer::display.brewer.all()
colors &lt;- brewer.pal(n = 5, name = "Set1")
print(colors)
blue &lt;- colors[2]
*orange &lt;- colors[5]
```
]
 
.panel2-color1-auto[
![](lab3_slides_files/figure-html/color1_auto_05_output-1.png)&lt;!-- --&gt;

```
[1] "#E41A1C" "#377EB8" "#4DAF4A" "#984EA3" "#FF7F00"
```
]

&lt;style&gt;
.panel1-color1-auto {
  color: black;
  width: 49%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-color1-auto {
  color: black;
  width: 49%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-color1-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

count: false
 
## EV in WA state: Relationship between price and range
.panel1-price_range2-non_seq[

```r
ggplot(ev_models,
       aes(x = electric_range, y = retail_price,
           color = ev_type, fill = ev_type)) +
  theme_cavis_hgrid +
  geom_point(alpha = 0.75)
```
]
 
.panel2-price_range2-non_seq[
![](lab3_slides_files/figure-html/price_range2_non_seq_01_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Relationship between price and range
.panel1-price_range2-non_seq[

```r
ggplot(ev_models,
       aes(x = electric_range, y = retail_price,
           color = ev_type, fill = ev_type)) +
  theme_cavis_hgrid +
  geom_point(alpha = 0.75) +
* geom_smooth(method = "lm",
*             alpha = 0.15, size = 0.45)
```
]
 
.panel2-price_range2-non_seq[
![](lab3_slides_files/figure-html/price_range2_non_seq_02_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Relationship between price and range
.panel1-price_range2-non_seq[

```r
ggplot(ev_models,
       aes(x = electric_range, y = retail_price,
           color = ev_type, fill = ev_type)) +
  theme_cavis_hgrid +
  geom_point(alpha = 0.75) +
  geom_smooth(method = "lm",
              alpha = 0.15, size = 0.45) +
* scale_x_continuous(trans = "log2")
```
]
 
.panel2-price_range2-non_seq[
![](lab3_slides_files/figure-html/price_range2_non_seq_03_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Relationship between price and range
.panel1-price_range2-non_seq[

```r
ggplot(ev_models,
       aes(x = electric_range, y = retail_price,
           color = ev_type, fill = ev_type)) +
  theme_cavis_hgrid +
  geom_point(alpha = 0.75) +
  geom_smooth(method = "lm",
              alpha = 0.15, size = 0.45) +
  scale_x_continuous(trans = "log2") +
* scale_y_continuous(trans = "log10",
*                    labels = label_dollar())
```
]
 
.panel2-price_range2-non_seq[
![](lab3_slides_files/figure-html/price_range2_non_seq_04_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Relationship between price and range
.panel1-price_range2-non_seq[

```r
ggplot(ev_models,
       aes(x = electric_range, y = retail_price,
           color = ev_type, fill = ev_type)) +
  theme_cavis_hgrid +
  geom_point(alpha = 0.75) +
  geom_smooth(method = "lm",
              alpha = 0.15, size = 0.45) +
  scale_x_continuous(trans = "log2") +
  scale_y_continuous(trans = "log10",
                     labels = label_dollar())+
* scale_color_manual(values = c(blue, orange)) +
* scale_fill_manual(values = c(blue, orange))
```
]
 
.panel2-price_range2-non_seq[
![](lab3_slides_files/figure-html/price_range2_non_seq_05_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Relationship between price and range
.panel1-price_range2-non_seq[

```r
ggplot(ev_models,
       aes(x = electric_range, y = retail_price,
           color = ev_type, fill = ev_type)) +
  theme_cavis_hgrid +
  geom_point(alpha = 0.75) +
  geom_smooth(method = "lm",
              alpha = 0.15, size = 0.45) +
  scale_x_continuous(trans = "log2") +
  scale_y_continuous(trans = "log10",
                     labels = label_dollar())+
  scale_color_manual(values = c(blue, orange)) +
  scale_fill_manual(values = c(blue, orange)) +
* geom_text_repel(
*   aes(label = paste(make, model, model_year)),
* )
```
]
 
.panel2-price_range2-non_seq[
![](lab3_slides_files/figure-html/price_range2_non_seq_06_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Relationship between price and range
.panel1-price_range2-non_seq[

```r
ggplot(ev_models,
       aes(x = electric_range, y = retail_price,
           color = ev_type, fill = ev_type)) +
  theme_cavis_hgrid +
  geom_point(alpha = 0.75) +
  geom_smooth(method = "lm",
              alpha = 0.15, size = 0.45) +
  scale_x_continuous(trans = "log2") +
  scale_y_continuous(trans = "log10",
                     labels = label_dollar())+
  scale_color_manual(values = c(blue, orange)) +
  scale_fill_manual(values = c(blue, orange)) +
  geom_text_repel(
    aes(label = paste(make, model, model_year)),
*   show.legend = FALSE,
*   size = 3, alpha = 0.75
  )
```
]
 
.panel2-price_range2-non_seq[
![](lab3_slides_files/figure-html/price_range2_non_seq_07_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Relationship between price and range
.panel1-price_range2-non_seq[

```r
ggplot(ev_models,
       aes(x = electric_range, y = retail_price,
           color = ev_type, fill = ev_type)) +
  theme_cavis_hgrid +
  geom_point(alpha = 0.75) +
  geom_smooth(method = "lm",
              alpha = 0.15, size = 0.45) +
  scale_x_continuous(trans = "log2") +
  scale_y_continuous(trans = "log10",
                     labels = label_dollar())+
  scale_color_manual(values = c(blue, orange)) +
  scale_fill_manual(values = c(blue, orange)) +
  geom_text_repel(
    aes(label = paste(make, model, model_year)),
    show.legend = FALSE,
    size = 3, alpha = 0.75
  ) +
* theme(legend.position = "top")
```
]
 
.panel2-price_range2-non_seq[
![](lab3_slides_files/figure-html/price_range2_non_seq_08_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Relationship between price and range
.panel1-price_range2-non_seq[

```r
ggplot(ev_models,
       aes(x = electric_range, y = retail_price,
           color = ev_type, fill = ev_type)) +
  theme_cavis_hgrid +
  geom_point(alpha = 0.75) +
  geom_smooth(method = "lm",
              alpha = 0.15, size = 0.45) +
  scale_x_continuous(trans = "log2") +
  scale_y_continuous(trans = "log10",
                     labels = label_dollar())+
  scale_color_manual(values = c(blue, orange)) +
  scale_fill_manual(values = c(blue, orange)) +
  geom_text_repel(
    aes(label = paste(make, model, model_year)),
    show.legend = FALSE,
    size = 3, alpha = 0.75
  ) +
  theme(legend.position = "top") +
* labs(y = "Retail price", x = "Electric range (mile)")
```
]
 
.panel2-price_range2-non_seq[
![](lab3_slides_files/figure-html/price_range2_non_seq_09_output-1.png)&lt;!-- --&gt;
]

&lt;style&gt;
.panel1-price_range2-non_seq {
  color: black;
  width: 49%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-price_range2-non_seq {
  color: black;
  width: 49%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-price_range2-non_seq {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

## Another segue: how to properly save a graph? 

- Don't use the `Export` interface in your RStudio

--

- Use code for reproducibility; explicitly declare parameters (e.g. for width, height and aspect ratio) 

--

- Use `ggsave()` function for ggplot2 objects


```r
width &lt;- 12
ggsave("ev_bivariate.pdf", width = width, height = width/1.618)
```

---

count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share_fail-auto[

```r
# bad example
*ev_data
```
]
 
.panel2-make_share_fail-auto[

```
# A tibble: 114,312 × 8
   county    city         make   model   model_year ev_type      elect…¹ retai…²
   &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;
 1 Kittitas  Cle Elum     TESLA  MODEL Y       2020 Battery Ele…     291       0
 2 Chelan    Chelan       TESLA  MODEL 3       2020 Battery Ele…     322       0
 3 Snohomish Snohomish    TESLA  MODEL 3       2018 Battery Ele…     215       0
 4 Thurston  Tumwater     FORD   C-MAX         2014 Plug-in Hyb…      19       0
 5 Kitsap    Kingston     FORD   FUSION        2013 Plug-in Hyb…      19       0
 6 King      Seattle      NISSAN LEAF          2018 Battery Ele…     151       0
 7 Skagit    Mount Vernon AUDI   E-TRON        2019 Battery Ele…     204       0
 8 Kitsap    Port Orchard NISSAN LEAF          2019 Battery Ele…     150       0
 9 Snohomish Bothell      TESLA  MODEL 3       2020 Battery Ele…     322       0
10 Yakima    Tieton       NISSAN LEAF          2019 Battery Ele…     150       0
# … with 114,302 more rows, and abbreviated variable names ¹​electric_range,
#   ²​retail_price
```
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share_fail-auto[

```r
# bad example
ev_data %&gt;%
* group_by(county, make)
```
]
 
.panel2-make_share_fail-auto[

```
# A tibble: 114,312 × 8
# Groups:   county, make [829]
   county    city         make   model   model_year ev_type      elect…¹ retai…²
   &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;
 1 Kittitas  Cle Elum     TESLA  MODEL Y       2020 Battery Ele…     291       0
 2 Chelan    Chelan       TESLA  MODEL 3       2020 Battery Ele…     322       0
 3 Snohomish Snohomish    TESLA  MODEL 3       2018 Battery Ele…     215       0
 4 Thurston  Tumwater     FORD   C-MAX         2014 Plug-in Hyb…      19       0
 5 Kitsap    Kingston     FORD   FUSION        2013 Plug-in Hyb…      19       0
 6 King      Seattle      NISSAN LEAF          2018 Battery Ele…     151       0
 7 Skagit    Mount Vernon AUDI   E-TRON        2019 Battery Ele…     204       0
 8 Kitsap    Port Orchard NISSAN LEAF          2019 Battery Ele…     150       0
 9 Snohomish Bothell      TESLA  MODEL 3       2020 Battery Ele…     322       0
10 Yakima    Tieton       NISSAN LEAF          2019 Battery Ele…     150       0
# … with 114,302 more rows, and abbreviated variable names ¹​electric_range,
#   ²​retail_price
```
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share_fail-auto[

```r
# bad example
ev_data %&gt;%
  group_by(county, make) %&gt;%
* count()
```
]
 
.panel2-make_share_fail-auto[

```
# A tibble: 829 × 3
# Groups:   county, make [829]
   county make          n
   &lt;chr&gt;  &lt;chr&gt;     &lt;int&gt;
 1 Adams  AUDI          1
 2 Adams  BMW           1
 3 Adams  CHEVROLET     6
 4 Adams  CHRYSLER      1
 5 Adams  FORD          5
 6 Adams  JEEP          1
 7 Adams  NISSAN        2
 8 Adams  RIVIAN        1
 9 Adams  SMART         1
10 Adams  TESLA        16
# … with 819 more rows
```
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share_fail-auto[

```r
# bad example
ev_data %&gt;%
  group_by(county, make) %&gt;%
  count() %&gt;%
* ggplot(aes(x = n, y = make))
```
]
 
.panel2-make_share_fail-auto[
![](lab3_slides_files/figure-html/make_share_fail_auto_04_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share_fail-auto[

```r
# bad example
ev_data %&gt;%
  group_by(county, make) %&gt;%
  count() %&gt;%
  ggplot(aes(x = n, y = make)) +
* theme_cavis_vgrid
```
]
 
.panel2-make_share_fail-auto[
![](lab3_slides_files/figure-html/make_share_fail_auto_05_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share_fail-auto[

```r
# bad example
ev_data %&gt;%
  group_by(county, make) %&gt;%
  count() %&gt;%
  ggplot(aes(x = n, y = make)) +
  theme_cavis_vgrid +
* geom_point()
```
]
 
.panel2-make_share_fail-auto[
![](lab3_slides_files/figure-html/make_share_fail_auto_06_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share_fail-auto[

```r
# bad example
ev_data %&gt;%
  group_by(county, make) %&gt;%
  count() %&gt;%
  ggplot(aes(x = n, y = make)) +
  theme_cavis_vgrid +
  geom_point() +
* facet_wrap(~ county)
```
]
 
.panel2-make_share_fail-auto[
![](lab3_slides_files/figure-html/make_share_fail_auto_07_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share_fail-auto[

```r
# bad example
ev_data %&gt;%
  group_by(county, make) %&gt;%
  count() %&gt;%
  ggplot(aes(x = n, y = make)) +
  theme_cavis_vgrid +
  geom_point() +
  facet_wrap(~ county) +
* scale_x_continuous(
*   trans = "log10",
*   labels = label_log()
* )
```
]
 
.panel2-make_share_fail-auto[
![](lab3_slides_files/figure-html/make_share_fail_auto_08_output-1.png)&lt;!-- --&gt;
]

&lt;style&gt;
.panel1-make_share_fail-auto {
  color: black;
  width: 49%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-make_share_fail-auto {
  color: black;
  width: 49%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-make_share_fail-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share1-auto[

```r
# Focus on the top 7 most popular makes
*ev_data
```
]
 
.panel2-make_share1-auto[

```
# A tibble: 114,312 × 8
   county    city         make   model   model_year ev_type      elect…¹ retai…²
   &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;
 1 Kittitas  Cle Elum     TESLA  MODEL Y       2020 Battery Ele…     291       0
 2 Chelan    Chelan       TESLA  MODEL 3       2020 Battery Ele…     322       0
 3 Snohomish Snohomish    TESLA  MODEL 3       2018 Battery Ele…     215       0
 4 Thurston  Tumwater     FORD   C-MAX         2014 Plug-in Hyb…      19       0
 5 Kitsap    Kingston     FORD   FUSION        2013 Plug-in Hyb…      19       0
 6 King      Seattle      NISSAN LEAF          2018 Battery Ele…     151       0
 7 Skagit    Mount Vernon AUDI   E-TRON        2019 Battery Ele…     204       0
 8 Kitsap    Port Orchard NISSAN LEAF          2019 Battery Ele…     150       0
 9 Snohomish Bothell      TESLA  MODEL 3       2020 Battery Ele…     322       0
10 Yakima    Tieton       NISSAN LEAF          2019 Battery Ele…     150       0
# … with 114,302 more rows, and abbreviated variable names ¹​electric_range,
#   ²​retail_price
```
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share1-auto[

```r
# Focus on the top 7 most popular makes
ev_data %&gt;%
* count(make)
```
]
 
.panel2-make_share1-auto[

```
# A tibble: 34 × 2
   make               n
   &lt;chr&gt;          &lt;int&gt;
 1 AUDI            2368
 2 AZURE DYNAMICS     7
 3 BENTLEY            3
 4 BMW             4742
 5 CADILLAC         106
 6 CHEVROLET      10253
 7 CHRYSLER        1815
 8 FIAT             808
 9 FISKER            18
10 FORD            6047
# … with 24 more rows
```
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share1-auto[

```r
# Focus on the top 7 most popular makes
ev_data %&gt;%
  count(make) %&gt;%
* slice_max(order_by = n, n = 7)
```
]
 
.panel2-make_share1-auto[

```
# A tibble: 7 × 2
  make          n
  &lt;chr&gt;     &lt;int&gt;
1 TESLA     52536
2 NISSAN    12826
3 CHEVROLET 10253
4 FORD       6047
5 BMW        4742
6 KIA        4553
7 TOYOTA     4422
```
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share1-auto[

```r
# Focus on the top 7 most popular makes
ev_data %&gt;%
  count(make) %&gt;%
  slice_max(order_by = n, n = 7) -&gt;
* top7_make
```
]
 
.panel2-make_share1-auto[

]

&lt;style&gt;
.panel1-make_share1-auto {
  color: black;
  width: 88.2%;
  hight: 32%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
.panel2-make_share1-auto {
  color: black;
  width: 9.8%;
  hight: 32%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
.panel3-make_share1-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share2-auto[

```r
# Shares of top-7 makes across county
*ev_data
```
]
 
.panel2-make_share2-auto[

```
# A tibble: 114,312 × 8
   county    city         make   model   model_year ev_type      elect…¹ retai…²
   &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;
 1 Kittitas  Cle Elum     TESLA  MODEL Y       2020 Battery Ele…     291       0
 2 Chelan    Chelan       TESLA  MODEL 3       2020 Battery Ele…     322       0
 3 Snohomish Snohomish    TESLA  MODEL 3       2018 Battery Ele…     215       0
 4 Thurston  Tumwater     FORD   C-MAX         2014 Plug-in Hyb…      19       0
 5 Kitsap    Kingston     FORD   FUSION        2013 Plug-in Hyb…      19       0
 6 King      Seattle      NISSAN LEAF          2018 Battery Ele…     151       0
 7 Skagit    Mount Vernon AUDI   E-TRON        2019 Battery Ele…     204       0
 8 Kitsap    Port Orchard NISSAN LEAF          2019 Battery Ele…     150       0
 9 Snohomish Bothell      TESLA  MODEL 3       2020 Battery Ele…     322       0
10 Yakima    Tieton       NISSAN LEAF          2019 Battery Ele…     150       0
# … with 114,302 more rows, and abbreviated variable names ¹​electric_range,
#   ²​retail_price
```
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share2-auto[

```r
# Shares of top-7 makes across county
ev_data %&gt;%
* group_by(county, make)
```
]
 
.panel2-make_share2-auto[

```
# A tibble: 114,312 × 8
# Groups:   county, make [829]
   county    city         make   model   model_year ev_type      elect…¹ retai…²
   &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;
 1 Kittitas  Cle Elum     TESLA  MODEL Y       2020 Battery Ele…     291       0
 2 Chelan    Chelan       TESLA  MODEL 3       2020 Battery Ele…     322       0
 3 Snohomish Snohomish    TESLA  MODEL 3       2018 Battery Ele…     215       0
 4 Thurston  Tumwater     FORD   C-MAX         2014 Plug-in Hyb…      19       0
 5 Kitsap    Kingston     FORD   FUSION        2013 Plug-in Hyb…      19       0
 6 King      Seattle      NISSAN LEAF          2018 Battery Ele…     151       0
 7 Skagit    Mount Vernon AUDI   E-TRON        2019 Battery Ele…     204       0
 8 Kitsap    Port Orchard NISSAN LEAF          2019 Battery Ele…     150       0
 9 Snohomish Bothell      TESLA  MODEL 3       2020 Battery Ele…     322       0
10 Yakima    Tieton       NISSAN LEAF          2019 Battery Ele…     150       0
# … with 114,302 more rows, and abbreviated variable names ¹​electric_range,
#   ²​retail_price
```
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share2-auto[

```r
# Shares of top-7 makes across county
ev_data %&gt;%
  group_by(county, make) %&gt;%
* count()
```
]
 
.panel2-make_share2-auto[

```
# A tibble: 829 × 3
# Groups:   county, make [829]
   county make          n
   &lt;chr&gt;  &lt;chr&gt;     &lt;int&gt;
 1 Adams  AUDI          1
 2 Adams  BMW           1
 3 Adams  CHEVROLET     6
 4 Adams  CHRYSLER      1
 5 Adams  FORD          5
 6 Adams  JEEP          1
 7 Adams  NISSAN        2
 8 Adams  RIVIAN        1
 9 Adams  SMART         1
10 Adams  TESLA        16
# … with 819 more rows
```
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share2-auto[

```r
# Shares of top-7 makes across county
ev_data %&gt;%
  group_by(county, make) %&gt;%
  count() %&gt;%
* filter(make %in% top7_make$make)
```
]
 
.panel2-make_share2-auto[

```
# A tibble: 260 × 3
# Groups:   county, make [260]
   county make          n
   &lt;chr&gt;  &lt;chr&gt;     &lt;int&gt;
 1 Adams  BMW           1
 2 Adams  CHEVROLET     6
 3 Adams  FORD          5
 4 Adams  NISSAN        2
 5 Adams  TESLA        16
 6 Asotin CHEVROLET     5
 7 Asotin FORD          1
 8 Asotin KIA           2
 9 Asotin NISSAN        8
10 Asotin TESLA        14
# … with 250 more rows
```
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share2-auto[

```r
# Shares of top-7 makes across county
ev_data %&gt;%
  group_by(county, make) %&gt;%
  count() %&gt;%
  filter(make %in% top7_make$make) %&gt;%
* group_by(county)
```
]
 
.panel2-make_share2-auto[

```
# A tibble: 260 × 3
# Groups:   county [39]
   county make          n
   &lt;chr&gt;  &lt;chr&gt;     &lt;int&gt;
 1 Adams  BMW           1
 2 Adams  CHEVROLET     6
 3 Adams  FORD          5
 4 Adams  NISSAN        2
 5 Adams  TESLA        16
 6 Asotin CHEVROLET     5
 7 Asotin FORD          1
 8 Asotin KIA           2
 9 Asotin NISSAN        8
10 Asotin TESLA        14
# … with 250 more rows
```
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share2-auto[

```r
# Shares of top-7 makes across county
ev_data %&gt;%
  group_by(county, make) %&gt;%
  count() %&gt;%
  filter(make %in% top7_make$make) %&gt;%
  group_by(county) %&gt;%
* mutate(county_sum = sum(n), prop = n / county_sum)
```
]
 
.panel2-make_share2-auto[

```
# A tibble: 260 × 5
# Groups:   county [39]
   county make          n county_sum   prop
   &lt;chr&gt;  &lt;chr&gt;     &lt;int&gt;      &lt;int&gt;  &lt;dbl&gt;
 1 Adams  BMW           1         30 0.0333
 2 Adams  CHEVROLET     6         30 0.2   
 3 Adams  FORD          5         30 0.167 
 4 Adams  NISSAN        2         30 0.0667
 5 Adams  TESLA        16         30 0.533 
 6 Asotin CHEVROLET     5         41 0.122 
 7 Asotin FORD          1         41 0.0244
 8 Asotin KIA           2         41 0.0488
 9 Asotin NISSAN        8         41 0.195 
10 Asotin TESLA        14         41 0.341 
# … with 250 more rows
```
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share2-auto[

```r
# Shares of top-7 makes across county
ev_data %&gt;%
  group_by(county, make) %&gt;%
  count() %&gt;%
  filter(make %in% top7_make$make) %&gt;%
  group_by(county) %&gt;%
  mutate(county_sum = sum(n), prop = n / county_sum) -&gt;
* make_share_byCounty
```
]
 
.panel2-make_share2-auto[

]

&lt;style&gt;
.panel1-make_share2-auto {
  color: black;
  width: 88.2%;
  hight: 32%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
.panel2-make_share2-auto {
  color: black;
  width: 9.8%;
  hight: 32%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
.panel3-make_share2-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;






---

count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share3-auto[

```r
# Coerce `make` into factor and put TESLA as last level
*make_share_byCounty
```
]
 
.panel2-make_share3-auto[

```
# A tibble: 260 × 5
# Groups:   county [39]
   county make          n county_sum   prop
   &lt;chr&gt;  &lt;chr&gt;     &lt;int&gt;      &lt;int&gt;  &lt;dbl&gt;
 1 Adams  BMW           1         30 0.0333
 2 Adams  CHEVROLET     6         30 0.2   
 3 Adams  FORD          5         30 0.167 
 4 Adams  NISSAN        2         30 0.0667
 5 Adams  TESLA        16         30 0.533 
 6 Asotin CHEVROLET     5         41 0.122 
 7 Asotin FORD          1         41 0.0244
 8 Asotin KIA           2         41 0.0488
 9 Asotin NISSAN        8         41 0.195 
10 Asotin TESLA        14         41 0.341 
# … with 250 more rows
```
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share3-auto[

```r
# Coerce `make` into factor and put TESLA as last level
make_share_byCounty %&gt;%
* mutate(make = as.factor(make),
*        make = fct_relevel(make, "TESLA", after = Inf))
```
]
 
.panel2-make_share3-auto[

```
# A tibble: 260 × 5
# Groups:   county [39]
   county make          n county_sum   prop
   &lt;chr&gt;  &lt;fct&gt;     &lt;int&gt;      &lt;int&gt;  &lt;dbl&gt;
 1 Adams  BMW           1         30 0.0333
 2 Adams  CHEVROLET     6         30 0.2   
 3 Adams  FORD          5         30 0.167 
 4 Adams  NISSAN        2         30 0.0667
 5 Adams  TESLA        16         30 0.533 
 6 Asotin CHEVROLET     5         41 0.122 
 7 Asotin FORD          1         41 0.0244
 8 Asotin KIA           2         41 0.0488
 9 Asotin NISSAN        8         41 0.195 
10 Asotin TESLA        14         41 0.341 
# … with 250 more rows
```
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share3-auto[

```r
# Coerce `make` into factor and put TESLA as last level
make_share_byCounty %&gt;%
  mutate(make = as.factor(make),
         make = fct_relevel(make, "TESLA", after = Inf)) -&gt;
* make_share_byCounty
```
]
 
.panel2-make_share3-auto[

]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share3-auto[

```r
# Coerce `make` into factor and put TESLA as last level
make_share_byCounty %&gt;%
  mutate(make = as.factor(make),
         make = fct_relevel(make, "TESLA", after = Inf)) -&gt;
  make_share_byCounty

# Check levels
*head(make_share_byCounty$make)
```
]
 
.panel2-make_share3-auto[

```
[1] BMW       CHEVROLET FORD      NISSAN    TESLA     CHEVROLET
Levels: BMW CHEVROLET FORD NISSAN KIA TOYOTA TESLA
```
]

&lt;style&gt;
.panel1-make_share3-auto {
  color: black;
  width: 88.2%;
  hight: 32%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
.panel2-make_share3-auto {
  color: black;
  width: 9.8%;
  hight: 32%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
.panel3-make_share3-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share4-non_seq[

```r
ggplot(make_share_byCounty,
       aes(x = prop,
           y = county,
           fill = make)) +
  theme_cavis
```
]
 
.panel2-make_share4-non_seq[
![](lab3_slides_files/figure-html/make_share4_non_seq_01_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share4-non_seq[

```r
ggplot(make_share_byCounty,
       aes(x = prop,
           y = county,
           fill = make)) +
  theme_cavis +
* geom_bar(
*   position = "stack", stat = "identity",
* )
```
]
 
.panel2-make_share4-non_seq[
![](lab3_slides_files/figure-html/make_share4_non_seq_02_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share4-non_seq[

```r
ggplot(make_share_byCounty,
       aes(x = prop,
           y = county,
           fill = make)) +
  theme_cavis +
  geom_bar(
    position = "stack", stat = "identity",
*   color = "white"
  )
```
]
 
.panel2-make_share4-non_seq[
![](lab3_slides_files/figure-html/make_share4_non_seq_03_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share4-non_seq[

```r
ggplot(make_share_byCounty,
       aes(x = prop,
           y = county,
           fill = make)) +
  theme_cavis +
  geom_bar(
    position = "stack", stat = "identity",
    color = "white"
  ) +
* scale_fill_brewer(
*   type = "qual",
* )
```
]
 
.panel2-make_share4-non_seq[
![](lab3_slides_files/figure-html/make_share4_non_seq_04_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share4-non_seq[

```r
ggplot(make_share_byCounty,
       aes(x = prop,
           y = county,
           fill = make)) +
  theme_cavis +
  geom_bar(
    position = "stack", stat = "identity",
    color = "white"
  ) +
  scale_fill_brewer(
    type = "qual",
*   palette = 4 ,
*   direction = -1
  )
```
]
 
.panel2-make_share4-non_seq[
![](lab3_slides_files/figure-html/make_share4_non_seq_05_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share4-non_seq[

```r
ggplot(make_share_byCounty,
       aes(x = prop,
           y = county,
           fill = make)) +
  theme_cavis +
  geom_bar(
    position = "stack", stat = "identity",
    color = "white"
  ) +
  scale_fill_brewer(
    type = "qual",
    palette = 4 ,
    direction = -1
  ) +
* scale_x_continuous(
*   expand = c(0, 0),
* )
```
]
 
.panel2-make_share4-non_seq[
![](lab3_slides_files/figure-html/make_share4_non_seq_06_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share4-non_seq[

```r
ggplot(make_share_byCounty,
       aes(x = prop,
           y = county,
           fill = make)) +
  theme_cavis +
  geom_bar(
    position = "stack", stat = "identity",
    color = "white"
  ) +
  scale_fill_brewer(
    type = "qual",
    palette = 4 ,
    direction = -1
  ) +
  scale_x_continuous(
    expand = c(0, 0),
*   labels = label_percent(),
*   sec.axis = dup_axis()
  )
```
]
 
.panel2-make_share4-non_seq[
![](lab3_slides_files/figure-html/make_share4_non_seq_07_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share4-non_seq[

```r
ggplot(make_share_byCounty,
       aes(x = prop,
           y = county,
           fill = make)) +
  theme_cavis +
  geom_bar(
    position = "stack", stat = "identity",
    color = "white"
  ) +
  scale_fill_brewer(
    type = "qual",
    palette = 4 ,
    direction = -1
  ) +
  scale_x_continuous(
    expand = c(0, 0),
    labels = label_percent(),
    sec.axis = dup_axis()
  ) +
* theme(aspect.ratio = 1.618)
```
]
 
.panel2-make_share4-non_seq[
![](lab3_slides_files/figure-html/make_share4_non_seq_08_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share4-non_seq[

```r
ggplot(make_share_byCounty,
       aes(x = prop,
           y = county,
           fill = make)) +
  theme_cavis +
  geom_bar(
    position = "stack", stat = "identity",
    color = "white"
  ) +
  scale_fill_brewer(
    type = "qual",
    palette = 4 ,
    direction = -1
  ) +
  scale_x_continuous(
    expand = c(0, 0),
    labels = label_percent(),
    sec.axis = dup_axis()
  ) +
  theme(aspect.ratio = 1.618) +
* labs(y = NULL, x = NULL)
```
]
 
.panel2-make_share4-non_seq[
![](lab3_slides_files/figure-html/make_share4_non_seq_09_output-1.png)&lt;!-- --&gt;
]

&lt;style&gt;
.panel1-make_share4-non_seq {
  color: black;
  width: 49%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-make_share4-non_seq {
  color: black;
  width: 49%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-make_share4-non_seq {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share5-user[

```r
*ggplot(make_share_byCounty,
*      aes(x = prop,
*          y = fct_reorder2(county, make, prop),
*          fill = make)) +
* theme_cavis +
* geom_bar(
*   position = "stack", stat = "identity",
*   color = "white"
* ) +
* scale_fill_brewer(
*   type = "qual",
*   palette = 4 ,
*   direction = -1
* ) +
* scale_x_continuous(
*   expand = c(0, 0),
*   labels = label_percent(),
*   sec.axis = dup_axis()
* ) +
* theme(aspect.ratio = 1.618) +
* labs(y = NULL, x = NULL)
```
]
 
.panel2-make_share5-user[
![](lab3_slides_files/figure-html/make_share5_user_01_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Shares of makes across counties
.panel1-make_share5-user[

```r
ggplot(make_share_byCounty,
       aes(x = prop,
           y = fct_reorder2(county, make, prop),
           fill = make)) +
  theme_cavis +
  geom_bar(
    position = "stack", stat = "identity",
    color = "white"
  ) +
  scale_fill_brewer(
    type = "qual",
    palette = 4 ,
    direction = -1
  ) +
  scale_x_continuous(
    expand = c(0, 0),
    labels = label_percent(),
    sec.axis = dup_axis()
  ) +
  theme(aspect.ratio = 1.618) +
  labs(y = NULL, x = NULL)
```
]
 
.panel2-make_share5-user[
![](lab3_slides_files/figure-html/make_share5_user_02_output-1.png)&lt;!-- --&gt;
]

&lt;style&gt;
.panel1-make_share5-user {
  color: black;
  width: 49%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-make_share5-user {
  color: black;
  width: 49%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-make_share5-user {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

count: false
 
## EV in WA state: Num. of EVs and median income
.panel1-ev_income1-auto[

```r
*ev_data
```
]
 
.panel2-ev_income1-auto[

```
# A tibble: 114,312 × 8
   county    city         make   model   model_year ev_type      elect…¹ retai…²
   &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;
 1 Kittitas  Cle Elum     TESLA  MODEL Y       2020 Battery Ele…     291       0
 2 Chelan    Chelan       TESLA  MODEL 3       2020 Battery Ele…     322       0
 3 Snohomish Snohomish    TESLA  MODEL 3       2018 Battery Ele…     215       0
 4 Thurston  Tumwater     FORD   C-MAX         2014 Plug-in Hyb…      19       0
 5 Kitsap    Kingston     FORD   FUSION        2013 Plug-in Hyb…      19       0
 6 King      Seattle      NISSAN LEAF          2018 Battery Ele…     151       0
 7 Skagit    Mount Vernon AUDI   E-TRON        2019 Battery Ele…     204       0
 8 Kitsap    Port Orchard NISSAN LEAF          2019 Battery Ele…     150       0
 9 Snohomish Bothell      TESLA  MODEL 3       2020 Battery Ele…     322       0
10 Yakima    Tieton       NISSAN LEAF          2019 Battery Ele…     150       0
# … with 114,302 more rows, and abbreviated variable names ¹​electric_range,
#   ²​retail_price
```
]

---
count: false
 
## EV in WA state: Num. of EVs and median income
.panel1-ev_income1-auto[

```r
ev_data %&gt;%
* group_by(county)
```
]
 
.panel2-ev_income1-auto[

```
# A tibble: 114,312 × 8
# Groups:   county [39]
   county    city         make   model   model_year ev_type      elect…¹ retai…²
   &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;
 1 Kittitas  Cle Elum     TESLA  MODEL Y       2020 Battery Ele…     291       0
 2 Chelan    Chelan       TESLA  MODEL 3       2020 Battery Ele…     322       0
 3 Snohomish Snohomish    TESLA  MODEL 3       2018 Battery Ele…     215       0
 4 Thurston  Tumwater     FORD   C-MAX         2014 Plug-in Hyb…      19       0
 5 Kitsap    Kingston     FORD   FUSION        2013 Plug-in Hyb…      19       0
 6 King      Seattle      NISSAN LEAF          2018 Battery Ele…     151       0
 7 Skagit    Mount Vernon AUDI   E-TRON        2019 Battery Ele…     204       0
 8 Kitsap    Port Orchard NISSAN LEAF          2019 Battery Ele…     150       0
 9 Snohomish Bothell      TESLA  MODEL 3       2020 Battery Ele…     322       0
10 Yakima    Tieton       NISSAN LEAF          2019 Battery Ele…     150       0
# … with 114,302 more rows, and abbreviated variable names ¹​electric_range,
#   ²​retail_price
```
]

---
count: false
 
## EV in WA state: Num. of EVs and median income
.panel1-ev_income1-auto[

```r
ev_data %&gt;%
  group_by(county) %&gt;%
* count()
```
]
 
.panel2-ev_income1-auto[

```
# A tibble: 39 × 2
# Groups:   county [39]
   county       n
   &lt;chr&gt;    &lt;int&gt;
 1 Adams       35
 2 Asotin      46
 3 Benton    1394
 4 Chelan     654
 5 Clallam    741
 6 Clark     6827
 7 Columbia    13
 8 Cowlitz    576
 9 Douglas    227
10 Ferry       27
# … with 29 more rows
```
]

---
count: false
 
## EV in WA state: Num. of EVs and median income
.panel1-ev_income1-auto[

```r
ev_data %&gt;%
  group_by(county) %&gt;%
  count() %&gt;%
* left_join(county_data, by = "county")
```
]
 
.panel2-ev_income1-auto[

```
# A tibble: 39 × 4
# Groups:   county [39]
   county       n hh_num hh_income
   &lt;chr&gt;    &lt;int&gt;  &lt;dbl&gt;     &lt;dbl&gt;
 1 Adams       35   5720     40829
 2 Asotin      46   9236     41665
 3 Benton    1394  65304     57354
 4 Chelan     654  27827     48674
 5 Clallam    741  31329     44398
 6 Clark     6827 158099     58262
 7 Columbia    13   1762     43611
 8 Cowlitz    576  40244     45877
 9 Douglas    227  13894     48708
10 Ferry       27   3190     35485
# … with 29 more rows
```
]

---
count: false
 
## EV in WA state: Num. of EVs and median income
.panel1-ev_income1-auto[

```r
ev_data %&gt;%
  group_by(county) %&gt;%
  count() %&gt;%
  left_join(county_data, by = "county") %&gt;%
* mutate(n_EV_perhh = n / hh_num * 1000)
```
]
 
.panel2-ev_income1-auto[

```
# A tibble: 39 × 5
# Groups:   county [39]
   county       n hh_num hh_income n_EV_perhh
   &lt;chr&gt;    &lt;int&gt;  &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
 1 Adams       35   5720     40829       6.12
 2 Asotin      46   9236     41665       4.98
 3 Benton    1394  65304     57354      21.3 
 4 Chelan     654  27827     48674      23.5 
 5 Clallam    741  31329     44398      23.7 
 6 Clark     6827 158099     58262      43.2 
 7 Columbia    13   1762     43611       7.38
 8 Cowlitz    576  40244     45877      14.3 
 9 Douglas    227  13894     48708      16.3 
10 Ferry       27   3190     35485       8.46
# … with 29 more rows
```
]

---
count: false
 
## EV in WA state: Num. of EVs and median income
.panel1-ev_income1-auto[

```r
ev_data %&gt;%
  group_by(county) %&gt;%
  count() %&gt;%
  left_join(county_data, by = "county") %&gt;%
  mutate(n_EV_perhh = n / hh_num * 1000) -&gt;
* ev_by_income
```
]
 
.panel2-ev_income1-auto[

]

&lt;style&gt;
.panel1-ev_income1-auto {
  color: black;
  width: 88.2%;
  hight: 32%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
.panel2-ev_income1-auto {
  color: black;
  width: 9.8%;
  hight: 32%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
.panel3-ev_income1-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;






---

count: false
 
## EV in WA state: Num. of EVs and median income
.panel1-ev_income2-auto[

```r
*ggplot(ev_by_income,
*      aes(x = hh_income, y = n_EV_perhh))
```
]
 
.panel2-ev_income2-auto[
![](lab3_slides_files/figure-html/ev_income2_auto_01_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Num. of EVs and median income
.panel1-ev_income2-auto[

```r
ggplot(ev_by_income,
       aes(x = hh_income, y = n_EV_perhh)) +
* theme_cavis_hgrid
```
]
 
.panel2-ev_income2-auto[
![](lab3_slides_files/figure-html/ev_income2_auto_02_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Num. of EVs and median income
.panel1-ev_income2-auto[

```r
ggplot(ev_by_income,
       aes(x = hh_income, y = n_EV_perhh)) +
  theme_cavis_hgrid +
* geom_point(alpha = 0.75, color = blue)
```
]
 
.panel2-ev_income2-auto[
![](lab3_slides_files/figure-html/ev_income2_auto_03_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Num. of EVs and median income
.panel1-ev_income2-auto[

```r
ggplot(ev_by_income,
       aes(x = hh_income, y = n_EV_perhh)) +
  theme_cavis_hgrid +
  geom_point(alpha = 0.75, color = blue) +
* scale_x_continuous(trans = "log10",
*                    labels = label_dollar())
```
]
 
.panel2-ev_income2-auto[
![](lab3_slides_files/figure-html/ev_income2_auto_04_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Num. of EVs and median income
.panel1-ev_income2-auto[

```r
ggplot(ev_by_income,
       aes(x = hh_income, y = n_EV_perhh)) +
  theme_cavis_hgrid +
  geom_point(alpha = 0.75, color = blue) +
  scale_x_continuous(trans = "log10",
                     labels = label_dollar()) +
* scale_y_continuous(trans = "log2")
```
]
 
.panel2-ev_income2-auto[
![](lab3_slides_files/figure-html/ev_income2_auto_05_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Num. of EVs and median income
.panel1-ev_income2-auto[

```r
ggplot(ev_by_income,
       aes(x = hh_income, y = n_EV_perhh)) +
  theme_cavis_hgrid +
  geom_point(alpha = 0.75, color = blue) +
  scale_x_continuous(trans = "log10",
                     labels = label_dollar()) +
  scale_y_continuous(trans = "log2") +
* geom_smooth(method = "lm", alpha = 0.2,
*             color = blue, fill = blue)
```
]
 
.panel2-ev_income2-auto[
![](lab3_slides_files/figure-html/ev_income2_auto_06_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Num. of EVs and median income
.panel1-ev_income2-auto[

```r
ggplot(ev_by_income,
       aes(x = hh_income, y = n_EV_perhh)) +
  theme_cavis_hgrid +
  geom_point(alpha = 0.75, color = blue) +
  scale_x_continuous(trans = "log10",
                     labels = label_dollar()) +
  scale_y_continuous(trans = "log2") +
  geom_smooth(method = "lm", alpha = 0.2,
              color = blue, fill = blue) +
* labs(y = "N of EVs per 1,000 household",
*      x = "Median household income")
```
]
 
.panel2-ev_income2-auto[
![](lab3_slides_files/figure-html/ev_income2_auto_07_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Num. of EVs and median income
.panel1-ev_income2-auto[

```r
ggplot(ev_by_income,
       aes(x = hh_income, y = n_EV_perhh)) +
  theme_cavis_hgrid +
  geom_point(alpha = 0.75, color = blue) +
  scale_x_continuous(trans = "log10",
                     labels = label_dollar()) +
  scale_y_continuous(trans = "log2") +
  geom_smooth(method = "lm", alpha = 0.2,
              color = blue, fill = blue) +
  labs(y = "N of EVs per 1,000 household",
       x = "Median household income") +
* geom_text_repel(aes(label = county))
```
]
 
.panel2-ev_income2-auto[
![](lab3_slides_files/figure-html/ev_income2_auto_08_output-1.png)&lt;!-- --&gt;
]

&lt;style&gt;
.panel1-ev_income2-auto {
  color: black;
  width: 49%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-ev_income2-auto {
  color: black;
  width: 49%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-ev_income2-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

count: false
 
## EV in WA state: Num. of EVs and median income
.panel1-ev_income3-auto[

```r
# find outliners
*lm(n_EV_perhh ~ hh_income, ev_by_income)
```
]
 
.panel2-ev_income3-auto[

```

Call:
lm(formula = n_EV_perhh ~ hh_income, data = ev_by_income)

Coefficients:
(Intercept)    hh_income  
 -52.683902     0.001614  
```
]

---
count: false
 
## EV in WA state: Num. of EVs and median income
.panel1-ev_income3-auto[

```r
# find outliners
lm(n_EV_perhh ~ hh_income, ev_by_income) %&gt;%
* broom::augment(ev_by_income)
```
]
 
.panel2-ev_income3-auto[

```
# A tibble: 39 × 11
   county       n hh_num hh_income n_EV_p…¹ .fitted .resid   .hat .sigma .cooksd
   &lt;chr&gt;    &lt;int&gt;  &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
 1 Adams       35   5720     40829     6.12   13.2   -7.11 0.0426   14.8 5.51e-3
 2 Asotin      46   9236     41665     4.98   14.6   -9.60 0.0385   14.7 9.01e-3
 3 Benton    1394  65304     57354    21.3    39.9  -18.6  0.0653   14.5 6.04e-2
 4 Chelan     654  27827     48674    23.5    25.9   -2.39 0.0263   14.8 3.73e-4
 5 Clallam    741  31329     44398    23.7    19.0    4.66 0.0291   14.8 1.57e-3
 6 Clark     6827 158099     58262    43.2    41.4    1.81 0.0728   14.8 6.48e-4
 7 Columbia    13   1762     43611     7.38   17.7  -10.3  0.0312   14.7 8.35e-3
 8 Cowlitz    576  40244     45877    14.3    21.4   -7.07 0.0265   14.8 3.28e-3
 9 Douglas    227  13894     48708    16.3    26.0   -9.61 0.0264   14.7 6.03e-3
10 Ferry       27   3190     35485     8.46    4.60   3.86 0.0817   14.8 3.38e-3
# … with 29 more rows, 1 more variable: .std.resid &lt;dbl&gt;, and abbreviated
#   variable name ¹​n_EV_perhh
```
]

---
count: false
 
## EV in WA state: Num. of EVs and median income
.panel1-ev_income3-auto[

```r
# find outliners
lm(n_EV_perhh ~ hh_income, ev_by_income) %&gt;%
  broom::augment(ev_by_income) %&gt;%
* slice_max(order_by = abs(.resid), n = 10)
```
]
 
.panel2-ev_income3-auto[

```
# A tibble: 10 × 11
   county        n hh_num hh_income n_EV_…¹ .fitted .resid   .hat .sigma .cooksd
   &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
 1 San Juan    729   7613     50726   95.8    29.2   66.5  0.0301   9.61 0.333  
 2 Jefferson   699  14049     46048   49.8    21.7   28.1  0.0263  14.0  0.0514 
 3 King      60059 789232     68065   76.1    57.2   18.9  0.196   14.4  0.254  
 4 Benton     1394  65304     57354   21.3    39.9  -18.6  0.0653  14.5  0.0604 
 5 Lincoln      29   4422     45582    6.56   20.9  -14.3  0.0269  14.6  0.0137 
 6 Klickitat   177   8327     37398   21.3     7.69  13.6  0.0651  14.6  0.0321 
 7 Pierce     8684 299918     57869   29.0    40.7  -11.8  0.0695  14.7  0.0261 
 8 Garfield      4    989     42269    4.04   15.6  -11.5  0.0359  14.7  0.0120 
 9 Columbia     13   1762     43611    7.38   17.7  -10.3  0.0312  14.7  0.00835
10 Kittitas    396  16595     41232   23.9    13.9    9.98 0.0406  14.7  0.0103 
# … with 1 more variable: .std.resid &lt;dbl&gt;, and abbreviated variable name
#   ¹​n_EV_perhh
```
]

---
count: false
 
## EV in WA state: Num. of EVs and median income
.panel1-ev_income3-auto[

```r
# find outliners
lm(n_EV_perhh ~ hh_income, ev_by_income) %&gt;%
  broom::augment(ev_by_income) %&gt;%
  slice_max(order_by = abs(.resid), n = 10) %&gt;%
* pull(county)
```
]
 
.panel2-ev_income3-auto[

```
 [1] "San Juan"  "Jefferson" "King"      "Benton"    "Lincoln"   "Klickitat"
 [7] "Pierce"    "Garfield"  "Columbia"  "Kittitas" 
```
]

---
count: false
 
## EV in WA state: Num. of EVs and median income
.panel1-ev_income3-auto[

```r
# find outliners
lm(n_EV_perhh ~ hh_income, ev_by_income) %&gt;%
  broom::augment(ev_by_income) %&gt;%
  slice_max(order_by = abs(.resid), n = 10) %&gt;%
  pull(county) -&gt;
* outliners
```
]
 
.panel2-ev_income3-auto[

]

&lt;style&gt;
.panel1-ev_income3-auto {
  color: black;
  width: 88.2%;
  hight: 32%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
.panel2-ev_income3-auto {
  color: black;
  width: 9.8%;
  hight: 32%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
.panel3-ev_income3-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;






---

count: false
 
## EV in WA state: Num. of EVs and median income
.panel1-ev_income4-user[

```r
*ggplot(ev_by_income,
*      aes(x = hh_income, y = n_EV_perhh)) +
* theme_cavis_hgrid +
* geom_point(alpha = 0.75, color = blue) +
* scale_x_continuous(trans = "log10",
*                    labels = label_dollar()) +
* scale_y_continuous(trans = "log2") +
* geom_smooth(method = "lm", alpha = 0.2,
*             color = blue, fill = blue) +
* labs(y = "N of EVs per 1,000 household",
*      x = "Median household income")
```
]
 
.panel2-ev_income4-user[
![](lab3_slides_files/figure-html/ev_income4_user_01_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
## EV in WA state: Num. of EVs and median income
.panel1-ev_income4-user[

```r
ggplot(ev_by_income,
       aes(x = hh_income, y = n_EV_perhh)) +
  theme_cavis_hgrid +
  geom_point(alpha = 0.75, color = blue) +
  scale_x_continuous(trans = "log10",
                     labels = label_dollar()) +
  scale_y_continuous(trans = "log2") +
  geom_smooth(method = "lm", alpha = 0.2,
              color = blue, fill = blue) +
  labs(y = "N of EVs per 1,000 household",
       x = "Median household income") +
* geom_text_repel(
*   data = filter(ev_by_income,
*                 county %in% outliners),
*   aes(label = county)
* )
```
]
 
.panel2-ev_income4-user[
![](lab3_slides_files/figure-html/ev_income4_user_02_output-1.png)&lt;!-- --&gt;
]

&lt;style&gt;
.panel1-ev_income4-user {
  color: black;
  width: 49%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-ev_income4-user {
  color: black;
  width: 49%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-ev_income4-user {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

## Some takeaways

- Don't rely on defaults; starts with minimalist aesthetics

--
  
- Understand the consequence of `inherit.aes = TRUE` and how to take advantage/overwrite it 

--
  
- Learn to scale everything (color, fill, x-axis, y-axis, etc)

--
  
- Choose nice colors with `RColorBrewer` 

--
  
- Order things intelligently with `factor`

--
  
- Save graphic output correctly with `ggsave`
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
